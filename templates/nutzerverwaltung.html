<h2>Nutzerverwaltung</h2>

<form method="get" action="{{ url_for('benutzer_erstellen') }}">
    <button type="submit">➕ Benutzer hinzufügen</button>
</form>

<!-- Alle Benutzer als Tabelle anzeigen -->
<table border="1" cellpadding="6">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Rolle</th>
        <th>Aktion</th>
    </tr>
    {% for benutzer in benutzer_liste %}
    <tr>
        <td>{{ benutzer.id }}</td>
        <td>{{ benutzer.name }}</td>
        <td>{{ benutzer.email }}</td>
        <td>
            <!-- Bei Lehrenden zugewiesene Module anzeigen  -->
            {% if benutzer.__class__.__name__ == "Lehrende" %}
                Lehrende für:<br>
                {% for modul in benutzer.module %}
                    {{modul.titel}}{% if not loop.last %}, <br>{% endif %}
                {% endfor %}
            {% else %}
                {{ benutzer.__class__.__name__ }}
            {% endif %}
        </td>
        <td>
            <!-- Button zum Löschen eines Benutzers -->
            <form method="post" action="{{ url_for('benutzer_loeschen') }}">
                <input type="hidden" name="benutzer_id" value="{{ benutzer.id }}">
                <button type="submit" onclick="return confirm('Benutzer wirklich löschen?')">Benutzer Löschen</button>
            </form>

            <!-- Bei Lehrenden Modul-Menü und Button "zuweisen" und "entziehen" anzeigen -->
            {% if benutzer.__class__.__name__ == "Lehrende" %}
                <form method="post" action="{{ url_for('modul_aktion') }}">
                    <input type="hidden" name="lehrende_id" value="{{ benutzer.id }}">
                    
                    <select name="modul_id">
                        <option value="">-- Modul auswählen --</option>
                        {% for modul in module %}
                            <option value="{{ modul.id }}">{{ modul.titel }}</option>
                        {% endfor %}
                    </select>

                    <button type="submit" name="aktion" value="zuweisen">Modul zuweisen</button>
                    <button type="submit" name="aktion" value="entziehen">Modul entziehen</button>
                </form>

            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

<!-- Flash-Meldungen anzeigen -->
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div style="background-color: #fff8dc; border: 1px solid #daa520; padding: 0.5em; border-radius: 4px;">
            {% for msg in messages %}
                <strong>{{ msg }}</strong>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<!-- zurrück zur Übersicht navigieren -->
<a href="{{ url_for('uebersicht') }}">← Zurück zur Übersicht</a>
